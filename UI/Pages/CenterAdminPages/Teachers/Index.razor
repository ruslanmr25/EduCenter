@page "/teachers"


@attribute [Authorize(Roles = "CenterAdmin")]


@if (isLoading)
{

     <MudStack Row="true" Justify="Justify.Center">

          <MudProgressCircular Class="ms-n1" Size="Size.Medium" Color="Color.Primary" Indeterminate="true" />
     </MudStack>

}

else
{

     <MudContainer MaxWidth="MaxWidth.ExtraLarge">


          <MudText Typo="Typo.h6" Color="Color.Primary" Class="my-4">O'qituvchilar</MudText>



          <MudPaper Class="px-10 py-5 ma-0" Height="90%" Elevation="0">

               <MudStack Row="true" Justify="Justify.FlexEnd">

                    <NavLink Href="/teachers/create">
                         <MudButton StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary" Variant="Variant.Filled"
                              Class="mb-4" Size="Size.Small">
                              Qo'shish
                         </MudButton>
                    </NavLink>

               </MudStack>


               <MudTable Elevation="0" Items="@teachers.Items" Hover="true" Breakpoint="Breakpoint.Md">


                    <HeaderContent>
                         <MudTh>Nr</MudTh>

                         <MudTh>F.I.SH</MudTh>
                         <MudTh>Foydalanuvchi nomi</MudTh>



                    </HeaderContent>


                    <RowTemplate>

                         <MudTd DataLabel="Nr">@(teachers.Items.IndexOf(context) + 1)</MudTd>
                         <MudTd DataLabel="Name">@context.FullName</MudTd>
                         <MudTd DataLabel="Name">@context.Username</MudTd>



                    </RowTemplate>
                    <PagerContent>
                         <MudStack Row="true" Justify="Justify.FlexEnd">
                              <MudPagination BoundaryCount="1" MiddleCount="3" Count="teachers.Meta!.TotalPages"
                                   Selected="@_selected" SelectedChanged="@GetTeachersAsync" />
                         </MudStack>
                    </PagerContent>

               </MudTable>



          </MudPaper>


     </MudContainer>

}



@inject TeacherClient teacherClient
@code
{
     protected string? name;

     protected int _selected = 1;

     protected bool isLoading = false;
     protected Collection<User> teachers = new();


     protected override async Task OnInitializedAsync()
     {

          await GetTeachersAsync(1);

     }

     protected async Task GetTeachersAsync(int i)
     {
          isLoading = true;
          var response = await teacherClient.GetAllAsync(i);


          if (!response.Success)
          {
               return;
          }

          teachers = response.Data!;

          _selected = i;

          isLoading = false;


     }
}